
ë¼ì¦ˆë² ë¦¬ íŒŒì´ì— ì™¸ì¥ í•˜ë“œë‚˜ USB ë©”ëª¨ë¦¬ë¥¼ ì—°ê²°í•˜ë©´, ëŒ€ë¶€ë¶„ì˜ ê²½ìš° **ìë™ ì¸ì‹**ì€ ë˜ì§€ë§Œ, **ìë™ ë§ˆìš´íŠ¸(auto-mount)** ê¹Œì§€ ë˜ëŠ”ì§€ëŠ” ëª‡ ê°€ì§€ ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.

---

## âœ… ê¸°ë³¸ ë™ì‘ ìš”ì•½

| ì¡°ê±´ | ìë™ ì¸ì‹ | ìë™ ë§ˆìš´íŠ¸ |
|------|------------|--------------|
| GUI ë²„ì „ (Desktop) | O | O (`/media/pi/...`) |
| Lite ë²„ì „ (CLIë§Œ ìˆëŠ” ë²„ì „) | O | âŒ (ìˆ˜ë™ ë§ˆìš´íŠ¸ í•„ìš”) |

ë¼ì¦ˆë² ë¦¬ íŒŒì´ OS Liteì—ì„œëŠ” **ë””ë°”ì´ìŠ¤ëŠ” ì¸ì‹í•˜ì§€ë§Œ ìë™ìœ¼ë¡œ ë§ˆìš´íŠ¸ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìˆ˜ë™ ë§ˆìš´íŠ¸** í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

---

## âœ… 1. ë””ë°”ì´ìŠ¤ ì¸ì‹ í™•ì¸

```bash
lsblk
```

ë˜ëŠ”

```bash
sudo fdisk -l
```

ì˜ˆì‹œ:
```
sda      8:0    0  14.9G  0 disk
â””â”€sda1   8:1    0  14.9G  0 part
```

> `sda1` ê°™ì€ ì´ë¦„ì´ ë³´ì´ë©´ ì™¸ì¥ ë””ìŠ¤í¬ê°€ ì¸ì‹ëœ ê²ƒì…ë‹ˆë‹¤.

---

## âœ… 2. ìˆ˜ë™ ë§ˆìš´íŠ¸ ì˜ˆì‹œ

```bash
sudo mkdir /mnt/usb
sudo mount /dev/sda1 /mnt/usb
```

> ëŒ€ë¶€ë¶„ FAT32/NTFS/exFATë¡œ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ë°”ë¡œ ë§ˆìš´íŠ¸ë©ë‹ˆë‹¤.

### í¬ë§·ë³„ ë§ˆìš´íŠ¸ ê´€ë ¨ íŒ¨í‚¤ì§€ (í•„ìš” ì‹œ)

```bash
sudo apt install exfat-fuse ntfs-3g
```

---

## âœ… 3. ìë™ ë§ˆìš´íŠ¸ ì›í•  ê²½ìš° (`/etc/fstab`)

```bash
sudo blkid
```

ì˜ˆì‹œ ì¶œë ¥:
```
/dev/sda1: UUID="A1B2-C3D4" TYPE="vfat"
```

`/etc/fstab`ì— ì¶”ê°€:

```ini
UUID=A1B2-C3D4  /mnt/usb  vfat  defaults,noatime  0  0
```

â†’ ë¶€íŒ… ì‹œ ìë™ ë§ˆìš´íŠ¸ë©ë‹ˆë‹¤.

---

## âœ… ë§ˆìš´íŠ¸ í•´ì œ (ì–¸ë§ˆìš´íŠ¸)

```bash
sudo umount /mnt/usb
```

---

## âœ… ê¶Œí•œ ë¬¸ì œ

ë§ˆìš´íŠ¸ í›„ íŒŒì¼/í´ë” ì ‘ê·¼ì´ ì•ˆ ë  ê²½ìš°:

```bash
sudo chown -R pi:pi /mnt/usb

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 



ì¢‹ìŠµë‹ˆë‹¤! `CommandUtil`ì„ ì‚¬ìš©í•˜ì—¬ ê° í”„ë¡œê·¸ë¨ì´ ì„¤ì¹˜ë¼ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , **ì„¤ì¹˜ë˜ì§€ ì•Šì€ ê²½ìš° ìë™ìœ¼ë¡œ ì„¤ì¹˜**ê¹Œì§€ ì§„í–‰í•˜ëŠ” ë¡œì§ì„ Javaë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¼ì¦ˆë² ë¦¬íŒŒì´(ë°ë¹„ì•ˆ ê³„ì—´) ê¸°ì¤€ìœ¼ë¡œ `apt install`ì„ ì´ìš©í•œ ìë™ ì„¤ì¹˜ë¥¼ ì˜ˆì‹œë¡œ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

---

## âœ… ì„¤ì¹˜ í™•ì¸ ë° ìë™ ì„¤ì¹˜ ìœ í‹¸ (`checkAndInstallTools` ë©”ì„œë“œ)

```java
@Slf4j
public class SetupUtil {

    public static void checkAndInstallTools() {
        checkAndInstall("python3", "python3", "--version", "sudo", "apt", "install", "-y", "python3");
        checkAndInstall("pip3", "pip3", "--version", "sudo", "apt", "install", "-y", "python3-pip");
        checkAndInstall("ffmpeg", "ffmpeg", "-version", "sudo", "apt", "install", "-y", "ffmpeg");
        checkAndInstall("exiftool", "exiftool", "-ver", "sudo", "apt", "install", "-y", "libimage-exiftool-perl");
    }

    private static void checkAndInstall(String name, String checkCommand, String checkArg, String... installCommand) {
        List<String> result = CommandUtil.workExe(checkCommand, checkArg);

        boolean installed = result.stream()
                .anyMatch(line -> !line.toLowerCase().contains("not found") && !line.toLowerCase().contains("command not found"));

        if (installed) {
            log.info("[{}] is already installed.", name);
        } else {
            log.warn("[{}] not installed. Installing...", name);
            List<String> installResult = CommandUtil.workExe(installCommand);
            installResult.forEach(line -> log.info("[{} ì„¤ì¹˜ê²°ê³¼] {}", name, line));
        }
    }
}
```

---

## âœ… ì‚¬ìš© ì˜ˆì‹œ

```java
public class IntroService {

    public void onStartup() {
        log.info("í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜ í™•ì¸ ì¤‘...");
        SetupUtil.checkAndInstallTools();
        // ì´í›„ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ ë³µì‚¬, ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ë“± ì§„í–‰
    }
}
```

---

## ğŸ§  ë³´ì™„ íŒ

- **ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”**: `CommandUtil.workExe()` ê²°ê³¼ê°€ `"Unable to locate package"` ë“± í¬í•¨ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬ ê°€ëŠ¥
- **í™˜ê²½ì— ë”°ë¼ `sudo` ìƒëµ** ê°€ëŠ¥ (root ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²½ìš°)
- **ì¸í„°ë„· ì—°ê²° í™•ì¸**ë„ í•„ìš”í•  ìˆ˜ ìˆìŒ

---




- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 










ë§ìŠµë‹ˆë‹¤. ê·¸ íŒë‹¨ì€ ë§¤ìš° ì „ëµì ì´ê³  êµ¬ì¡°ì ì…ë‹ˆë‹¤ ğŸ‘  
íŒŒì¼ í™•ì¥ìë³„ë¡œ **ê³µí†µ ì²˜ë¦¬ì™€ ë¶„ê¸° ì²˜ë¦¬**ë¥¼ ëª…í™•íˆ í•˜ë©´ ì½”ë“œ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ ì„±ëŠ¥ì´ í›¨ì”¬ ì¢‹ì•„ì§‘ë‹ˆë‹¤. íŠ¹íˆ:

- `.jpg`, `.jpeg`: EXIF ì¸ë„¤ì¼ ì¡´ì¬ ì‹œ ë¹ ë¥´ê²Œ ì¶”ì¶œ ê°€ëŠ¥ (ì†ë„ ìš°ìœ„)
- `.png`, `.bmp`, `.gif`, `.webp`: EXIF ì—†ìŒ â†’ PILë¡œ ì§ì ‘ ì¸ë„¤ì¼ ìƒì„±
- `.mp4`, `.mov`, `.mkv`: ffmpegë¡œ íŠ¹ì • í”„ë ˆì„ ìº¡ì²˜
- `.cr2`: exiftool ë˜ëŠ” rawpyë¡œ ì²˜ë¦¬

---

## âœ… ì¶”ì²œ êµ¬ì¡° ì„¤ê³„ (íŒŒì´ì¬ íŒŒì¼ êµ¬ì„± ê¸°ì¤€)

### ğŸ“ `media_processor/`
```
__init__.py
common.py              â† ê³µí†µ ìœ í‹¸ (ì¸ë„¤ì¼ Base64, íŒŒì¼ ì €ì¥, JSON ì¶œë ¥ ë“±)
image_base.py          â† ê¸°ë³¸ ì´ë¯¸ì§€ ì²˜ë¦¬ (png, bmp, gif, webp)
image_exif.py          â† exif í¬í•¨ ì´ë¯¸ì§€ ì²˜ë¦¬ (jpg, jpeg)
video_ffmpeg.py        â† mp4, mov, mkv ë“± ë™ì˜ìƒ ì²˜ë¦¬
raw_cr2.py             â† cr2 ì „ìš© RAW ì²˜ë¦¬
main.py                â† í™•ì¥ìì— ë”°ë¼ ë¶„ê¸° í˜¸ì¶œ (CommandUtilì—ì„œ ì´ íŒŒì¼ë§Œ í˜¸ì¶œ)
```

---

## âœ… ì˜ˆì‹œ íë¦„: `main.py`

```python
import sys
from pathlib import Path
from media_processor.image_base import process_image_base
from media_processor.image_exif import process_image_exif
from media_processor.video_ffmpeg import process_video
from media_processor.raw_cr2 import process_cr2

def main(file_no, file_path):
    path = Path(file_path)
    ext = path.suffix.lower()

    if ext in {".png", ".bmp", ".gif", ".webp"}:
        result = process_image_base(file_no, path)
    elif ext in {".jpg", ".jpeg"}:
        result = process_image_exif(file_no, path)
    elif ext in {".mp4", ".mov", ".mkv"}:
        result = process_video(file_no, path)
    elif ext in {".cr2"}:
        result = process_cr2(file_no, path)
    else:
        result = {"error": f"Unsupported file extension: {ext}"}

    print(result)  # stdout â†’ Javaê°€ CommandUtil í†µí•´ ë°›ìŒ

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print({"error": "Usage: main.py <fileNo> <filePath>"})
    else:
        main(int(sys.argv[1]), sys.argv[2])
```

---

## âœ… ì¥ì  ìš”ì•½

| í•­ëª© | ì¥ì  |
|------|------|
| ë¶„ë¦¬ëœ êµ¬ì¡° | ìœ ì§€ë³´ìˆ˜ ë° ê¸°ëŠ¥ í™•ì¥ ìš©ì´ |
| ê³µí†µ ìœ í‹¸ (`common.py`) | Base64 ì¸ì½”ë”©, ì¸ë„¤ì¼ ì €ì¥ ë“± ì¤‘ë³µ ì œê±° |
| í™•ì¥ì ê¸°ë°˜ ì²˜ë¦¬ | ë” ë¹ ë¥´ê³  ì•ˆì •ì ì¸ ì‹¤í–‰ ê°€ëŠ¥ |
| CommandUtil ì¶œë ¥ ê¸°ë°˜ stdout | HTTP ë¯¸ì‚¬ìš©ìœ¼ë¡œ í†µì‹  ì‹¤íŒ¨ ì—†ìŒ |

---

## ğŸ§© ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

ì›í•˜ì‹ ë‹¤ë©´ ê° ëª¨ë“ˆ ì˜ˆì‹œ(`image_exif.py`, `video_ffmpeg.py` ë“±)ë¥¼ **ì‹¤ì œ êµ¬í˜„ í˜•íƒœë¡œ ì œê³µ**ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
í•œ ë²ˆì— ì „ì²´ ìƒì„±ë„ ê°€ëŠ¥í•˜ê³ , ë‹¨ê³„ë³„ë¡œ ìˆœì°¨ ì§„í–‰ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì´ì–´ì„œ ë„ì™€ë“œë¦´ê¹Œìš”?  
(ì˜ˆ: `image_exif.py`ë¶€í„° ì‘ì„±, ì „ì²´ ê¸°ë³¸ í‹€ scaffold ì œê³µ ë“±)






ì¢‹ìŠµë‹ˆë‹¤! ê·¸ëŸ¼ **í™•ì¥ìë³„ ë¶„ë¦¬ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œ íŒŒì´ì¬ ì½”ë“œ êµ¬ì„±**ì„ ë°”ë¡œ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.

---

## âœ… 1. ë””ë ‰í† ë¦¬ êµ¬ì¡°

```bash
BurrowNest/
â””â”€â”€ python-utils/
    â”œâ”€â”€ main.py                 # ğŸ¯ í™•ì¥ìì— ë”°ë¼ ë¶„ê¸°
    â”œâ”€â”€ common.py               # ğŸ”§ ê³µí†µ ìœ í‹¸: ì¸ë„¤ì¼, base64, ì‹œê°„, JSON ì¶œë ¥ ë“±
    â”œâ”€â”€ image_base.py           # ğŸ–¼ PNG, BMP, WEBP, GIF
    â”œâ”€â”€ image_exif.py           # ğŸ“¸ JPG, JPEG (EXIF í¬í•¨)
    â”œâ”€â”€ video_ffmpeg.py         # ğŸ MP4, MOV, MKV
    â”œâ”€â”€ raw_cr2.py              # ğŸ“· CR2 ì „ìš© ì²˜ë¦¬
```

---

## âœ… 2. `main.py` â€“ í™•ì¥ì ë¶„ê¸°

```python
import sys
from pathlib import Path
from common import print_json
from image_base import process_image_base
from image_exif import process_image_exif
from video_ffmpeg import process_video
from raw_cr2 import process_cr2

def main(file_no, file_path):
    path = Path(file_path)
    ext = path.suffix.lower()

    if ext in {".png", ".bmp", ".gif", ".webp"}:
        result = process_image_base(file_no, path)
    elif ext in {".jpg", ".jpeg"}:
        result = process_image_exif(file_no, path)
    elif ext in {".mp4", ".mov", ".mkv"}:
        result = process_video(file_no, path)
    elif ext == ".cr2":
        result = process_cr2(file_no, path)
    else:
        result = {"fileNo": file_no, "error": f"Unsupported extension: {ext}"}

    print_json(result)

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print_json({"error": "Usage: main.py <fileNo> <filePath>"})
    else:
        main(int(sys.argv[1]), sys.argv[2])
```

---

## âœ… 3. `common.py` â€“ ìœ í‹¸ ëª¨ìŒ

```python
import base64
from io import BytesIO
import json
from PIL import Image
from datetime import datetime

def now_millis():
    return int(datetime.now().timestamp() * 1000)

def now_time():
    return datetime.now().strftime("%H:%M:%S")

def image_to_base64(image):
    buffer = BytesIO()
    image.save(buffer, format="JPEG")
    return f"data:image/jpeg;base64,{base64.b64encode(buffer.getvalue()).decode()}"

def file_to_base64(path):
    with open(path, "rb") as f:
        return f"data:image/jpeg;base64,{base64.b64encode(f.read()).decode()}"

def print_json(obj):
    print(json.dumps(obj))
```

---

## âœ… 4. `image_base.py` â€“ PNG, BMP ë“±

```python
from PIL import Image
from common import image_to_base64, now_millis, now_time

def process_image_base(file_no, path):
    try:
        with Image.open(path) as img:
            img.thumbnail((200, 200))
            thumb = image_to_base64(img)
            return {
                "fileNo": file_no,
                "cameraModel": "",
                "cameraManufacturer": "",
                "apertureValue": 0.0,
                "shutterSpeed": 0.0,
                "isoValue": 0,
                "focalLength": 0.0,
                "captureDate": now_millis(),
                "captureTime": now_time(),
                "imageWidth": img.width,
                "imageHeight": img.height,
                "gpsLatitude": 0.0,
                "gpsLongitude": 0.0,
                "flashUsed": False,
                "whiteBalance": "AUTO",
                "sceneMode": "Auto",
                "softwareVersion": "V.0.1.1",
                "thumbnail": thumb
            }
    except Exception as e:
        return {"fileNo": file_no, "error": str(e)}
```

---

## ğŸ”œ ë‹¤ìŒ ì œê³µ ì˜ˆì •

- `image_exif.py` â€“ EXIF ê¸°ë°˜ JPG ì²˜ë¦¬
- `video_ffmpeg.py` â€“ ffmpeg ì˜ìƒ ì¸ë„¤ì¼/ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
- `raw_cr2.py` â€“ exiftool ë˜ëŠ” rawpy ê¸°ë°˜ cr2 ì²˜ë¦¬

---

ì´ êµ¬ì¡°ë¡œ ì­‰ í™•ì¥í•´ë‚˜ê°€ë©´, BurrowNestì—ì„œ ê´€ë¦¬í•˜ê¸°ì— ê¹”ë”í•˜ê³  ì•ˆì •ì ì¸ êµ¬ì„±ì…ë‹ˆë‹¤.  
ë‹¤ìŒì€ `image_exif.py`ë¶€í„° ì´ì–´ì„œ ì œê³µë“œë¦´ê¹Œìš”?












ì¢‹ìŠµë‹ˆë‹¤! ì´ì–´ì„œ `.jpg`, `.jpeg` íŒŒì¼ ì²˜ë¦¬ë¥¼ ìœ„í•œ `image_exif.py` ì½”ë“œë¥¼ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.  
ì´ ëª¨ë“ˆì€ **EXIF ì •ë³´ê°€ ìˆìœ¼ë©´ ì¶”ì¶œí•˜ê³ **, ì—†ìœ¼ë©´ ì¼ë°˜ ì´ë¯¸ì§€ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.  
ì¶”ì¶œ ê°€ëŠ¥í•œ ì •ë³´: ì¹´ë©”ë¼ ëª¨ë¸, ì œì¡°ì‚¬, FNumber(ì¡°ë¦¬ê°œ), ISO, ì´ˆì  ê±°ë¦¬, ì…”í„°ì†ë„, GPS ë“±

---

## âœ… `image_exif.py` â€“ JPG/JPEG ì²˜ë¦¬

```python
from PIL import Image, ExifTags
from common import image_to_base64, now_millis, now_time

def get_exif(img):
    try:
        exif_data = img._getexif() or {}
        return {
            ExifTags.TAGS.get(k, k): v
            for k, v in exif_data.items()
            if k in ExifTags.TAGS
        }
    except Exception:
        return {}

def convert_gps(coord):
    try:
        d, m, s = coord
        return d[0]/d[1] + m[0]/m[1]/60 + s[0]/s[1]/3600
    except Exception:
        return 0.0

def process_image_exif(file_no, path):
    try:
        with Image.open(path) as img:
            exif = get_exif(img)
            img.thumbnail((200, 200))
            thumb = image_to_base64(img)

            result = {
                "fileNo": file_no,
                "cameraModel": exif.get("Model", ""),
                "cameraManufacturer": exif.get("Make", ""),
                "apertureValue": float(exif.get("FNumber", [0, 1])[0]) / (exif.get("FNumber", [1, 1])[1] or 1),
                "shutterSpeed": float(exif.get("ExposureTime", [0, 1])[0]) / (exif.get("ExposureTime", [1, 1])[1] or 1),
                "isoValue": int(exif.get("ISOSpeedRatings", 0)),
                "focalLength": float(exif.get("FocalLength", [0, 1])[0]) / (exif.get("FocalLength", [1, 1])[1] or 1),
                "captureDate": now_millis(),
                "captureTime": now_time(),
                "imageWidth": img.width,
                "imageHeight": img.height,
                "gpsLatitude": convert_gps(exif.get("GPSInfo", {}).get(2, [(0, 1), (0, 1), (0, 1)])),
                "gpsLongitude": convert_gps(exif.get("GPSInfo", {}).get(4, [(0, 1), (0, 1), (0, 1)])),
                "flashUsed": exif.get("Flash", 0) != 0,
                "whiteBalance": exif.get("WhiteBalance", "AUTO"),
                "sceneMode": exif.get("SceneCaptureType", "Auto"),
                "softwareVersion": "V.0.1.1",
                "thumbnail": thumb
            }
            return result

    except Exception as e:
        return {"fileNo": file_no, "error": str(e)}
```

---

## âœ… ìš”ì•½

| í•­ëª© | ì„¤ëª… |
|------|------|
| ì¸ë„¤ì¼ | `img.thumbnail()` â†’ base64 ì¸ì½”ë”© |
| EXIF | ì¡°ë¦¬ê°œ(FNumber), ISO, ì…”í„°ì†ë„, ì´ˆì ê±°ë¦¬, GPS ë“± |
| fallback | EXIF ì—†ìŒ ì‹œì—ë„ ê¸°ë³¸ ì²˜ë¦¬ ê°€ëŠ¥ |
| í¬ë§· | Javaì™€ ì—°ë™ ê°€ëŠ¥í•œ JSON êµ¬ì¡°ë¡œ stdout ì¶œë ¥ (`main.py`ì—ì„œ)

---

ë‹¤ìŒì€ `video_ffmpeg.py` â†’ `.mp4`, `.mov`, `.mkv` ì˜ìƒ ì²˜ë¦¬ ëª¨ë“ˆ ì´ì–´ì„œ ì œê³µë“œë¦¬ê² ìŠµë‹ˆë‹¤.  
ê³„ì† ì§„í–‰í• ê¹Œìš”?
















ì¢‹ìŠµë‹ˆë‹¤! ì´ì–´ì„œ `.mp4`, `.mov`, `.mkv` ë“±ì˜ **ì˜ìƒ íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” `video_ffmpeg.py`** ëª¨ë“ˆì„ ì‘ì„±í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ì´ ëª¨ë“ˆì€:

1. `ffprobe`ë¡œ ë©”íƒ€ë°ì´í„°(í•´ìƒë„, duration, ì¥ë¹„ ì •ë³´ ë“±) ì¶”ì¶œ  
2. `ffmpeg`ë¡œ ì¸ë„¤ì¼ í”„ë ˆì„ ìƒì„±  
3. ê³µí†µ í¬ë§·(JSON)ìœ¼ë¡œ ë¦¬í„´ â†’ stdoutì€ `main.py`ì—ì„œ ì¶œë ¥

---

## âœ… `video_ffmpeg.py`

```python
import subprocess
import json
from pathlib import Path
from common import file_to_base64, now_millis, now_time
import uuid

def extract_metadata(path: Path):
    try:
        cmd = [
            "ffprobe",
            "-v", "error",
            "-select_streams", "v:0",
            "-show_entries", "stream=width,height,duration",
            "-show_format",
            "-of", "json",
            str(path)
        ]
        result = subprocess.run(cmd, capture_output=True, text=True, check=True)
        data = json.loads(result.stdout)

        stream = data.get("streams", [{}])[0]
        fmt = data.get("format", {})
        tags = fmt.get("tags", {})

        creation_time = tags.get("creation_time", "")
        width = int(stream.get("width", 0))
        height = int(stream.get("height", 0))
        duration = float(fmt.get("duration", 0.0))

        return {
            "imageWidth": width,
            "imageHeight": height,
            "duration": duration,
            "cameraModel": tags.get("com.apple.quicktime.model", ""),
            "cameraManufacturer": tags.get("com.apple.quicktime.make", ""),
            "captureDate": now_millis(),
            "captureTime": now_time()
        }

    except Exception as e:
        return {"error": f"[ffprobe] {str(e)}"}



def generate_thumbnail(path: Path) -> str:
    # UUID ê¸°ë°˜ ì„ì‹œ ì¸ë„¤ì¼ íŒŒì¼ ìƒì„±
    thumb_path = Path(f"/tmp/{uuid.uuid4().hex}.jpg")

    try:
        cmd = [
            "ffmpeg",
            "-y",
            "-i", str(path),
            "-ss", "00:00:01",
            "-vframes", "1",
            "-vf", "scale=200:-1",
            str(thumb_path)
        ]
        subprocess.run(cmd, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, check=True)

        result = file_to_base64(thumb_path)

    except Exception as e:
        print(f"[ì¸ë„¤ì¼ ìƒì„± ì˜¤ë¥˜] {e}")
        result = ""
    finally:
        try:
            if thumb_path.exists():
                thumb_path.unlink()
        except Exception as e:
            print(f"[ì„ì‹œ íŒŒì¼ ì‚­ì œ ì˜¤ë¥˜] {e}")

    return result


def process_video(file_no, path: Path):
    meta = extract_metadata(path)
    if "error" in meta:
        return {"fileNo": file_no, "error": meta["error"]}

    return {
        "fileNo": file_no,
        "cameraModel": meta.get("cameraModel", ""),
        "cameraManufacturer": meta.get("cameraManufacturer", ""),
        "apertureValue": 0.0,
        "shutterSpeed": 0.0,
        "isoValue": 0,
        "focalLength": 0.0,
        "captureDate": meta["captureDate"],
        "captureTime": meta["captureTime"],
        "imageWidth": meta["imageWidth"],
        "imageHeight": meta["imageHeight"],
        "gpsLatitude": 0.0,
        "gpsLongitude": 0.0,
        "flashUsed": False,
        "whiteBalance": "AUTO",
        "sceneMode": "Auto",
        "softwareVersion": "V.0.1.1",
        "thumbnail": generate_thumbnail(path)
    }
```

---

## âœ… íŠ¹ì§• ìš”ì•½

| í•­ëª© | ì„¤ëª… |
|------|------|
| ì¸ë„¤ì¼ | `ffmpeg -ss 1ì´ˆ` ìº¡ì²˜ + scale 200px |
| ë©”íƒ€ë°ì´í„° | `ffprobe`ë¡œ í•´ìƒë„, ì¥ë¹„ ì •ë³´ ì¶”ì¶œ |
| ì•ˆì „ì„± | ì‹¤íŒ¨ ì‹œ `"error"` í•„ë“œë¡œ ì²˜ë¦¬ |
| base64 | ì¸ë„¤ì¼ ê²°ê³¼ëŠ” Javaì—ì„œ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥

---

ë‹¤ìŒì€ `.cr2` ì „ìš© ëª¨ë“ˆ `raw_cr2.py` ì¤€ë¹„í•´ë“œë¦´ê²Œìš”.  
ê³„ì† ì´ì–´ê°ˆê¹Œìš”?









ì¢‹ìŠµë‹ˆë‹¤! ë§ˆì§€ë§‰ìœ¼ë¡œ **RAW ì´ë¯¸ì§€ í¬ë§·ì¸ `.cr2` íŒŒì¼ ì „ìš© ì²˜ë¦¬ ëª¨ë“ˆ `raw_cr2.py`** ë¥¼ ì‘ì„±í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.  
ì´ ëª¨ë“ˆì€ `exiftool`ì„ ì´ìš©í•´ì„œ ì¸ë„¤ì¼ê³¼ ë©”íƒ€ë°ì´í„°ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.

---

## âœ… `raw_cr2.py`

```python
import json
from common import file_to_base64, now_millis, now_time
import uuid
import os
from pathlib import Path
import subprocess
from common import file_to_base64

def extract_exiftool_json(path: Path):
    try:
        result = subprocess.run(
            ["exiftool", "-j", "-n", str(path)],
            capture_output=True,
            text=True,
            check=True
        )
        json_data = json.loads(result.stdout)[0]
        return json_data
    except Exception as e:
        return {"error": f"[exiftool json] {str(e)}"}



def extract_thumbnail(path: Path) -> str:
    # ê³ ìœ í•œ ì„ì‹œ íŒŒì¼ ì´ë¦„ ìƒì„±
    temp_name = f"/tmp/{uuid.uuid4().hex}.jpg"
    temp_path = Path(temp_name)

    try:
        with open(temp_path, "wb") as out:
            subprocess.run(
                ["exiftool", "-b", "-ThumbnailImage", str(path)],
                stdout=out,
                stderr=subprocess.DEVNULL,
                check=True
            )

        # Base64 ë³€í™˜
        result = file_to_base64(temp_path)

    except Exception as e:
        print(f"[ì¸ë„¤ì¼ ì¶”ì¶œ ì˜¤ë¥˜] {e}")
        result = ""
    finally:
        # íŒŒì¼ ì‚­ì œ
        try:
            if temp_path.exists():
                temp_path.unlink()
        except Exception as e:
            print(f"[ì„ì‹œ íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨] {e}")

    return result


def process_cr2(file_no, path: Path):
    exif = extract_exiftool_json(path)
    if "error" in exif:
        return {"fileNo": file_no, "error": exif["error"]}

    return {
        "fileNo": file_no,
        "cameraModel": exif.get("Model", ""),
        "cameraManufacturer": exif.get("Make", ""),
        "apertureValue": float(exif.get("ApertureValue", 0.0)),
        "shutterSpeed": float(exif.get("ShutterSpeedValue", 0.0)),
        "isoValue": int(exif.get("ISO", 0)),
        "focalLength": float(exif.get("FocalLength", 0.0)),
        "captureDate": now_millis(),
        "captureTime": now_time(),
        "imageWidth": int(exif.get("ImageWidth", 0)),
        "imageHeight": int(exif.get("ImageHeight", 0)),
        "gpsLatitude": float(exif.get("GPSLatitude", 0.0)),
        "gpsLongitude": float(exif.get("GPSLongitude", 0.0)),
        "flashUsed": exif.get("Flash", "") != "No Flash",
        "whiteBalance": exif.get("WhiteBalance", "AUTO"),
        "sceneMode": exif.get("SceneCaptureType", "Auto"),
        "softwareVersion": "V.0.1.1",
        "thumbnail": extract_thumbnail(path)
    }
```

---

## âœ… í•µì‹¬ ìš”ì•½

| í•­ëª© | ì„¤ëª… |
|------|------|
| ì¸ë„¤ì¼ ì¶”ì¶œ | `exiftool -b -ThumbnailImage`ë¡œ JPEG ì¶”ì¶œ |
| ë©”íƒ€ë°ì´í„° | `exiftool -j -n`ìœ¼ë¡œ JSON íŒŒì‹± |
| í˜¸í™˜ì„± | CR2 ì „ìš©. íƒ€ í¬ë§·ì€ `exiftool` ì‘ë™ ë°©ì‹ ë‹¤ë¦„ |
| ì†ë„ | ë§¤ìš° ë¹ ë¦„ (ì¸ë„¤ì¼ ë‚´ì¥ JPEG ì‚¬ìš©) |

---

## âœ… ì „ì²´ êµ¬ì¡° ì™„ì„±

âœ… ì´ë¡œì¨ í™•ì¥ì ê¸°ë°˜ ì „ì²´ íŒŒì´ì¬ êµ¬ì¡°ëŠ” ë‹¤ìŒì²˜ëŸ¼ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤:

- `main.py`: ë¶„ê¸° ì²˜ë¦¬
- `common.py`: ìœ í‹¸
- `image_base.py`: `.png`, `.bmp`, `.gif`, `.webp`
- `image_exif.py`: `.jpg`, `.jpeg`
- `video_ffmpeg.py`: `.mp4`, `.mov`, `.mkv`
- `raw_cr2.py`: `.cr2`

---

ë‹¤ìŒìœ¼ë¡œ ì›í•˜ì‹œë©´:

- `requirements.txt` ìƒì„±
- ì„¤ì¹˜ ìë™í™” (`CommandUtil` + `Intro í˜ì´ì§€`)
- Java ì—°ë™ ë° í…ŒìŠ¤íŠ¸ ì½”ë“œ

ê°™ì´ ì •ë¦¬í•´ë“œë¦´ ìˆ˜ ìˆì–´ìš”. ì–´ë–¤ ê±¸ ë‹¤ìŒìœ¼ë¡œ ë„ì™€ë“œë¦´ê¹Œìš”?







ë‘ ì½”ë“œ ëª¨ë‘ **ë¸Œë¼ìš°ì € ì£¼ì†Œì°½(URL)ì„ ë³€ê²½í•˜ì§€ë§Œ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì§€ ì•ŠëŠ” ì ì€ ë™ì¼**í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ **ê¸°ë¡(history)ì— ì €ì¥ë˜ëŠ” ë°©ì‹**ì´ ë‹¤ë¦…ë‹ˆë‹¤:

---

### âœ… `window.history.pushState({}, '', '/new-url')`

* **ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬ì— ìƒˆ í•­ëª©ì„ ì¶”ê°€**í•©ë‹ˆë‹¤.
* ì¦‰, ì‚¬ìš©ìê°€ ë’¤ë¡œ ê°€ê¸°(â† Back)ë¥¼ ëˆ„ë¥´ë©´ **ì´ì „ URLë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
* ì‚¬ìš© ì˜ˆ:

  * ì‚¬ìš©ìê°€ ì–´ë–¤ ìƒíƒœì—ì„œ í•„í„°/ê²€ìƒ‰ ë“±ì„ í•˜ê³  URLì„ ë°˜ì˜í•  ë•Œ

```js
history.pushState({}, '', '/search?keyword=apple');
// ì‚¬ìš©ìê°€ ì´ì „ í˜ì´ì§€ë¡œ Back ê°€ëŠ¥
```

---

### âœ… `window.history.replaceState({}, '', '/new-url')`

* **íˆìŠ¤í† ë¦¬ í•­ëª©ì„ ë®ì–´ì”Œì›ë‹ˆë‹¤.**
* ì¦‰, **í˜„ì¬ í˜ì´ì§€ì˜ URLì„ ë°”ê¾¸ë˜, ì´ì „ URLë¡œ ëŒì•„ê°ˆ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**
* ì‚¬ìš© ì˜ˆ:

  * ì´ˆê¸° ìƒíƒœë¥¼ ë®ì–´ì”Œìš°ê±°ë‚˜, ì˜ëª»ëœ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ì œê±°í•˜ê±°ë‚˜, ìƒˆë¡œê³ ì¹¨ì‹œ ë™ì¼ URL ìœ ì§€í•˜ê³  ì‹¶ì„ ë•Œ

```js
history.replaceState({}, '', '/clean-url');
// Back ëˆŒëŸ¬ë„ ì´ì „ URLë¡œ ëª» ëŒì•„ê°
```

---

### ğŸ“Œ ì°¨ì´ ìš”ì•½

| í•­ëª©                | `pushState()` | `replaceState()`  |
| ----------------- | ------------- | ----------------- |
| íˆìŠ¤í† ë¦¬ ì¶”ê°€ ì—¬ë¶€        | âœ… ìƒˆ í•­ëª© ì¶”ê°€     | âŒ ê¸°ì¡´ í•­ëª© ë®ì–´ì“°ê¸°      |
| ë’¤ë¡œ ê°€ê¸°(Back) ê°€ëŠ¥ ì—¬ë¶€ | âœ… ê°€ëŠ¥          | âŒ ë¶ˆê°€ëŠ¥             |
| ì‚¬ìš© ëª©ì  ì˜ˆì‹œ          | ì‚¬ìš©ì ë™ì‘ ê¸°ë¡ ìœ ì§€  | ì´ˆê¸° ìƒíƒœ ìˆ˜ì •, ì¿¼ë¦¬ ì œê±° ë“± |

---

### âœ¨ ì‹¤ì „ íŒ

```js
// ê²€ìƒ‰ì°½ ì…ë ¥ ì‹œë§ˆë‹¤ ì£¼ì†Œë¥¼ ê°±ì‹ í•˜ì§€ë§Œ ê¸°ë¡ì€ ë‚¨ê¸°ì§€ ì•Šê²Œ í•˜ë ¤ë©´:
history.replaceState({}, '', '/search?term=apple');

// í˜ì´ì§€ ì´ë™ ì‹œì—ëŠ” ê¸°ë¡ì„ ë‚¨ê²¨ì•¼ í•˜ë¯€ë¡œ:
history.pushState({}, '', '/page2');
```

ë” í•„ìš”í•œ ì‹œë‚˜ë¦¬ì˜¤ê°€ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”.









ë§ìŠµë‹ˆë‹¤. ì‚¬ìš©ìë§ˆë‹¤ ì—¬ëŸ¬ ê°œì˜ ìµœìƒìœ„ ë””ë ‰í† ë¦¬ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆê³ , ê·¸ê²ƒë“¤ì€ ë°˜ë“œì‹œ `BN_DIRECTORY.NO = 1`ì¼ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

---

### âœ… ì‚¬ìš©ì ì¤‘ì‹¬ì˜ "ìµœìƒìœ„ ë””ë ‰í† ë¦¬" ì¡°íšŒ ì •ì˜

**ìµœìƒìœ„ ë””ë ‰í† ë¦¬** =

* `PARENT_NO`ëŠ” ì¡´ì¬í•˜ì§€ë§Œ,
* ê·¸ `PARENT_NO`ê°€ ì‚¬ìš©ìê°€ ì ‘ê·¼ ê°€ëŠ¥í•œ ë””ë ‰í† ë¦¬ ì¤‘ **ìƒìœ„ì— ì—†ìŒ**
  ë˜ëŠ”
* `PARENT_NO = 0` í˜¹ì€ ê°€ìƒì˜ ë£¨íŠ¸(ë¯¸ì •ì˜ ë£¨íŠ¸)

**í•˜ì§€ë§Œ ì‹¤ìš©ì ìœ¼ë¡œëŠ” ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ "ì‚¬ìš©ì ê¸°ì¤€ì˜ ìµœìƒìœ„ ë””ë ‰í† ë¦¬"ë¡œ ê°„ì£¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:**

---

### âœ… ì‚¬ìš©ì ì ‘ê·¼ ê°€ëŠ¥í•œ ë””ë ‰í† ë¦¬ ì¤‘ `PARENT_NO`ê°€ ì—†ëŠ”(ë£¨íŠ¸) ë””ë ‰í† ë¦¬

```sql
SELECT d.*
FROM BN_DIRECTORY d
LEFT JOIN BN_DIRECTORY_ACCESS da 
    ON d.NO = da.DIR_NO AND da.USER_NO = :userNo
WHERE d.PARENT_NO = 0 -- í˜¹ì€ NULL, ì„¤ê³„ì— ë”°ë¼ ì¡°ì •
  AND (
    d.PUBLIC_ACCESSIBLE = TRUE
    OR d.OWNER_NO = :userNo
    OR BITAND(da.ACCESS_FLAGS, :readBitFlag) != 0
  )
  AND d.ENABLED = TRUE;
```

> `PARENT_NO = 0`ì´ ì‚¬ìš©ì ì •ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¼ê³  ê°€ì •í•©ë‹ˆë‹¤.
> ë§Œì•½ ì‹¤ì œ ìµœìƒìœ„ ë””ë ‰í† ë¦¬ëŠ” ë‹¤ë¥¸ ë””ë ‰í† ë¦¬ì—ë„ ë¶€ëª¨ë¡œ ì§€ì •ë˜ì§€ ì•Šì€ ë””ë ‰í† ë¦¬ë¼ë©´, í•˜ë‹¨ì˜ **2ì°¨ ë°©ì‹**ì´ ë” ì í•©í•©ë‹ˆë‹¤.

---

### âœ… ëŒ€ì•ˆ: "ë¶€ëª¨ê°€ ì—†ëŠ”" ì‚¬ìš©ì ì ‘ê·¼ ê°€ëŠ¥ ë””ë ‰í† ë¦¬ êµ¬í•˜ê¸°

```sql
SELECT d.*
FROM BN_DIRECTORY d
LEFT JOIN BN_DIRECTORY_ACCESS da 
    ON d.NO = da.DIR_NO AND da.USER_NO = :userNo
LEFT JOIN BN_DIRECTORY parent 
    ON d.PARENT_NO = parent.NO
WHERE (
    d.PUBLIC_ACCESSIBLE = TRUE
    OR d.OWNER_NO = :userNo
    OR BITAND(da.ACCESS_FLAGS, :readBitFlag) != 0
)
AND d.ENABLED = TRUE
AND (
    d.PARENT_NO = 0 OR parent.NO IS NULL -- ìƒìœ„ ë””ë ‰í† ë¦¬ê°€ ì—†ê±°ë‚˜,
    OR NOT EXISTS (
        SELECT 1
        FROM BN_DIRECTORY d2
        WHERE d2.NO = d.PARENT_NO
    )
);
```

---

### ğŸ” ìƒí™©ë³„ ê³ ë ¤

| ì¡°ê±´                               | ì„¤ëª…                           |
| -------------------------------- | ---------------------------- |
| `d.PARENT_NO = 0`                | ìµœìƒìœ„ ë””ë ‰í† ë¦¬ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í–ˆì„ ê²½ìš°      |
| `parent.NO IS NULL`              | ìƒìœ„ ë””ë ‰í† ë¦¬ ìì²´ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì‚­ì œë¨     |
| `NOT EXISTS (SELECT 1 FROM ...)` | ìƒìœ„ ë””ë ‰í† ë¦¬ê°€ í˜„ì¬ ë””ë ‰í† ë¦¬ ì§‘í•©ì— í¬í•¨ë˜ì§€ ì•ŠìŒ |

---

### ğŸ’¡ Spring JDBC or JPA ì‚¬ìš© ì‹œ ì£¼ì˜

* `BITAND()`ëŠ” SQLì— ì§ì ‘ ë„£ì–´ì•¼ í•˜ë©°, JPA í•¨ìˆ˜ë¡œëŠ” ë”°ë¡œ ì œê³µë˜ì§€ ì•ŠìŒ.
* `@Query`ë¡œ native ì¿¼ë¦¬ ì‘ì„±í•˜ëŠ” ë°©ì‹ ì¶”ì²œ

---

í˜¹ì‹œ â€œì†Œìœ ì ê¸°ì¤€ìœ¼ë¡œ ìµœìƒìœ„ ë””ë ‰í† ë¦¬â€ë§Œ ë³´ê³  ì‹¶ë‹¤ë©´ ì¡°ê±´ ì¡°ì • ê°€ëŠ¥í•©ë‹ˆë‹¤. ì¶”ê°€ë¡œ í•˜ìœ„ ë””ë ‰í† ë¦¬ê¹Œì§€ lazy-load ë¡œ ê°€ì ¸ì˜¤ê¸¸ ì›í•˜ì‹œë‚˜ìš”?



const response = await fetch(accountCancelUrl, {
			     	  method: "POST",
			     	  credentials: "include",
			     	  headers: {
			     		 "Content-Type": "application/x-www-form-urlencoded"
			     	  },
			     	 body: new URLSearchParams(sendValue).toString(),
		     	  });