<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<!--//네임스페이스에는 mapper 가 있는 풀 패키지명과 매퍼명을 등록 한다. -->
<mapper namespace="com.utime.burrowNest.user.mapper.AdminMapper">

	<!-- 사용자 추가 -->
	<insert id="insertUser" parameterType="com.utime.burrowNest.user.vo.UserVo" useGeneratedKeys="true" keyProperty="userNo" >
		INSERT INTO BN_USER (
			UPDATE_DATE 
			, ENABLED
			, ID 
			, NICK_NAME 
			, ICON
			, ROLE
			, AUTH_HINT
		) VALUES (
			CURRENT_TIMESTAMP
			, #{enabled}
			, #{id}
			, #{nickname}
			, #{profileImg}
			, #{role}
			, #{authHint}
		)
	</insert>

	<!-- 사용자 목록 조회 -->
	<select id="getUserList" parameterType="map" resultType="com.utime.burrowNest.user.vo.UserVo">
		SELECT
			<include refid="com.utime.burrowNest.user.mapper.UserMapper.UserColumn" /> 
		FROM BN_USER
		<if test="id != null and id != '' ">
		WHERE ID LIKE '%${id}%'
		</if>
		ORDER BY NO DESC
	</select>
	
	
	<select id="getUserDetail" parameterType="map" resultType="com.utime.burrowNest.user.vo.UserVo">
		SELECT
			<include refid="com.utime.burrowNest.user.mapper.UserMapper.UserAllColumn" /> 
		FROM BN_USER
		WHERE NO = #{userNo}
	</select>
	
	<!-- 사용자 정보 갱신 -->
	<update id="updateUser" parameterType="com.utime.burrowNest.user.vo.UserVo" >
		UPDATE BN_USER SET
			UPDATE_DATE = CURRENT_TIMESTAMP
			, ENABLED = #{enabled}
			, NICK_NAME = #{nickname} 
			, ICON = #{profileImg}
			, ROLE = #{role}
			, NOTE = <choose> <when test="note != null and note != '' ">#{note}</when> <otherwise>NULL</otherwise> </choose>
			<if test="authHint != null and authHint != '' ">
			, AUTH_HINT = #{authHint}
			</if>
			, DAILY_UPLOAD_LIMIT = #{dailyUploadLimit} 
			, DAILY_DOWNLOAD_LIMIT = #{dailyDownloadLimit}
			, MAX_STORAGE_USAGE = #{maxStorageUsage}
		WHERE NO = #{userNo}
	</update>
	
	<!-- 회원 활성화 정보 수정 -->
	<update id="updateUserEnabled" parameterType="com.utime.burrowNest.user.vo.UserVo" >
		UPDATE BN_USER SET
			UPDATE_DATE = CURRENT_TIMESTAMP
			, ENABLED = #{enabled}
		WHERE NO = #{userNo}
	</update>
	
</mapper>