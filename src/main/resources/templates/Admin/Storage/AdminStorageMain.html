<div xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{Admin/Common/AdminLayout}">

    <th:block layout:fragment="title">그룹 저장소 관리</th:block>

    <th:block layout:fragment="css"></th:block>

    <div layout:fragment="content">
        <!-- 그룹 선택  -->
        <div class="flex border h-[500px] divide-x" id="GroupSelectList">
            <!-- 그룹 목록 -->
            <div class="w-1/3 overflow-y-auto">
                <ul id="groupList" class="divide-y">
                    <li th:each="group : ${groupList}" th:data-no="${group.groupNo}"
                        class="p-2 cursor-pointer hover:bg-blue-100" 
                        th:text="${group.name}"></li>
                </ul>
            </div>

            <!-- 디렉터리 목록 -->
            <div class="w-2/3 p-2">
                <div class="text-lg font-bold border-b mb-2">접근 Directory</div>
                <ul id="directoryList" class="space-y-1"></ul>
                <div class="flex mt-2">
                    <input id="newDirInput" type="text" placeholder="추가할 디렉터리 경로" 
                           class="border rounded w-full px-2 py-1 mr-2">
                    <button id="addDirBtn" class="bg-blue-500 text-white px-3 py-1 rounded">+</button>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="script">
    <script th:inline="javascript">
    const groupListEl = document.getElementById("groupList");
    const directoryListEl = document.getElementById("directoryList");
    const newDirInput = document.getElementById("newDirInput");
    const addDirBtn = document.getElementById("addDirBtn");

    let currentGroupNo = null;

    groupListEl.addEventListener("click", async (e) => {
        const li = e.target.closest("li");
        if (!li) return;

        groupListEl.querySelectorAll("li").forEach(el => el.classList.remove("bg-blue-500", "text-white"));
        li.classList.add("bg-blue-500", "text-white");

        currentGroupNo = li.dataset.no;
        const res = await fetch(`/Dir/Group/List.json?GroupNo=${currentGroupNo}`);
        const list = await res.json();

        renderDirectoryList(list);
    });

    addDirBtn.addEventListener("click", () => {
        const name = newDirInput.value.trim();
        if (!name || !currentGroupNo) return;

        const li = document.createElement("li");
        li.className = "flex justify-between items-center bg-white border p-2 rounded";
        li.innerHTML = `<span>${name}</span><button class='text-red-500 hover:text-red-700'>-</button>`;
        directoryListEl.appendChild(li);

        newDirInput.value = "";

        // TODO: API 저장 연동 필요
    });

    function renderDirectoryList(list) {
        directoryListEl.innerHTML = '';
        list.forEach(dir => {
            const li = document.createElement("li");
            li.className = "flex justify-between items-center bg-white border p-2 rounded";
            li.innerHTML = `<span>${dir.name}</span><button class='text-red-500 hover:text-red-700'>-</button>`;
            directoryListEl.appendChild(li);

            li.querySelector("button").addEventListener("click", () => {
                li.remove();
                // TODO: API 삭제 연동 필요
            });
        });
    }
    </script>
    </th:block>

</div>
