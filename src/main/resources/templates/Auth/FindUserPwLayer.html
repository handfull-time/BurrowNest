<div xmlns:th="http://www.thymeleaf.org">
    
     <h2 class="text-xl font-bold mb-4">비밀번호 변경</h2>
     
     <form id="pwSelectForm">
         <div class="space-y-4">
             <th:block th:if="${item.code eq '0'}">
		    	<table class="w-full border-collapse">
			        <tbody>
			            <th:block th:replace="~{Auth/AuthHint :: AuthHint}"></th:block>
			        </tbody>
			    </table>
		    </th:block>
             
             <div th:if="${item.code ne '0'}">
		    	일치하는 회원 정보를 찾을 수 없어요.
		    </div>
         </div>
         
         <div class="mt-6 transition-opacity duration-300" id="hiddenButtons">
            <button type="submit" id="FindUserPwBtn" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600" 
            	th:text="${item.code eq '0'? 'PW 변경':'PW 찾기'}" ></button>
            <div class="flex justify-between mt-2 text-sm text-blue-500 cursor-pointer">
                <a th:href="@{/User/Login.html}" class="hover:underline" th:if="${item.code eq '0'}" >로그인</a>
                <a th:href="@{/User/JoinUser.html}" class="hover:underline">회원 가입</a>
            </div>
        </div>
     </form>
     
    <script th:replace="~{Auth/AuthPassword :: script( func = 'btnStatus' )}"></script>
     
    <script th:inline="javascript">
     
	document.addEventListener('DOMContentLoaded', () => {
    	buttonStatus( 'FindUserPwBtn', false );
    });
     
    function btnStatus(status){
    	buttonStatus( 'FindUserPwBtn', status );
    }
     
 	document.getElementById("pwSelectForm").addEventListener("submit", async function(event) {
        event.preventDefault();
        
        if( /*[[${item.code eq '0'}]]*/ false ){
        	
        	const password = document.getElementById("password").value;
            
            const formData = new FormData();
            formData.append("token", /*[[${item.message}]]*/ null);
            formData.append("pw", encryptPassword(password));
            formData.append("rsaId", document.getElementById("rsaId").value);
            
            try {
		        const response = await fetch(/*[[@{/Auth/ConvertUserPw.json}]]*/ null, {
		            method: "POST",
		            //headers: { "Content-Type": "application/json" },
		            body: formData,
		            credentials: "include"
		        });
		
		        if (response.ok) {
		            const data = await response.json();
		            if( data.code === '0' ){
		            	showCustomAlert('성공적으로 변경됐습니다.', () => {
		            		window.location.href = /*[[@{/User/Login.html}]]*/ null;
		            	});
		            }else{
		            	showCustomAlert(data.code + " - " + data.message);
		            }
		        } else {
		        	showCustomAlert("비밀번호를 확인하세요.");
		        }
		    } catch (error) {
		        console.error("변경 오류:", error);
		        showCustomAlert("서버 오류가 발생했습니다.");
		    }
        }else{
        	window.location.href = /*[[@{/User/FindUserPw.html}]]*/ null;
        }
        
    });
    </script>
</div>

    