<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>🐇 BurrowNest</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <th:block th:replace="~{Common/Favicon :: Favicon}"></th:block>

    <script type="text/javascript" th:src="@{/js/tailwind/tailwind.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jsencrypt/jsencrypt.min.js}"></script>
</head>
<body class="h-screen flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-300">

  <div class="bg-white p-10 shadow-xl rounded-xl w-full max-w-lg text-center space-y-8">
    
    <!-- 제목 -->
    <h1 class="text-4xl md:text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 via-orange-500 to-yellow-400 animate-pulse">
      🐇 BurrowNest
    </h1>

    <!-- 로그인 폼 -->
    <form id="loginForm" class="space-y-4 text-left">
      <div>
        <label for="id" class="block text-sm font-medium text-gray-700 mb-1">아이디</label>
        <input type="text" id="id" maxlength="16"
               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
               placeholder="ID" />
      </div>

      <div>
        <label for="pw" class="block text-sm font-medium text-gray-700 mb-1">비밀번호</label>
        <div class="relative">
	        <input type="password" id="pw" maxlength="32" autocomplete="off"
	               class="w-full p-3 pr-10 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-red-400"
	               placeholder="Password" />
	        <button type="button" onclick="togglePassword()" class="absolute right-3 top-3">
			    🔑
			</button>
	     </div>
      </div>

      <button type="submit"
              class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition duration-300 shadow-md">
        로그인
      </button>
    </form>

    <!-- 연락처 -->
    <div class="text-sm text-gray-500 text-right">
      연락처: <a href="mailto:dev@pointpark.com" class="text-blue-600 hover:underline">utime@naver.com</a>
    </div>

  </div>

    
    
<script th:inline="javascript">
	
	function encryptPassword( value ) {
        const encrypt = new JSEncrypt();
        encrypt.setPublicKey(/*[[${unique.publicKey}]]*/ null);

        return encrypt.encrypt(value);
    }
	
	function togglePassword() {
	    const pwInput = document.getElementById("pw");
	    pwInput.type = pwInput.type === "password" ? "text" : "password";
	}

	document.getElementById("loginForm").addEventListener("submit", async function(event) {
	    event.preventDefault();
	
	    const encPw = encryptPassword( document.getElementById("pw").value );
	    
	    const requestData = {
	        id: document.getElementById("id").value,
	        pw: encPw,
	        token: /*[[${unique.token}]]*/ null,
	        rsaId: /*[[${unique.rsaId}]]*/ null
	    };
	
	    try {
	        const response = await fetch(/*[[@{/Auth/Login.json}]]*/ null, {
	            method: "POST",
	            headers: { "Content-Type": "application/json" },
	            body: JSON.stringify(requestData),
	            credentials: "include"
	        });
	
	        if (response.ok) {
	            const data = await response.json();
	            if( data.code === '0' ){
	            	window.location.href = data.message;
	            }else{
	            	alert(data.code + " - " + data.message);
	            }
	        } else {
	        	alert("아이디 또는 비밀번호를 확인하세요.");
	        }
	    } catch (error) {
	        console.error("로그인 오류:", error);
	        alert("서버 오류가 발생했습니다.");
	    }
	});
</script>    
</head>