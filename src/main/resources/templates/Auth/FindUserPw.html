<div xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{Auth/UserLayout}">
    
    <th:block layout:fragment="title">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</th:block>

	<th:block layout:fragment="css"></th:block>
	
    <div layout:fragment="content">
    	<div id="requestLayer" class="grid grid-cols-1 gap-4">
	        <form id="findPwForm" >
	        	<input type="hidden" id="rsaId" th:value="${unique.rsaId}">
	        	<input type="hidden" id="token" th:value="${unique.token}">
	        	<table class="w-full border-collapse">
			        <tbody>
			            <!-- ID -->
			            <tr>
			                <td class="w-1/4 font-medium p-2"><label for="id">ì•„ì´ë””</label></td>
			                <td class="w-3/4 p-2">
			                    <input type="text" id="id" name="id" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" minlength="4" maxlength="20" required>
			                    <p id="idCheckMessage" class="text-sm mt-1 text-red-500"></p>
			                </td>
			            </tr>
			            
			            <tr>
			            	<td colspan="2"></td>
			            </tr>
			            <tr>
			            	<td colspan="2" class="font-medium p-2">ì¢‹ì•„í•˜ëŠ” ê²ƒì„ ê³ ë¥´ì„¸ìš”.</td>
			            </tr>
			
			            <!-- ë³´ì•ˆ ì§ˆë¬¸: ë¬´ì§€ê°œ ìƒ‰ê¹” -->
			            <tr>
			                <td class="font-medium p-2">ë¬´ì§€ê°œ ìƒ‰ê¹”</td>
			                <td class="p-2">
			                    <select id="myRainbow" name="myRainbow" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" required>
			                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
			                        <option value="ë¹¨ê°•">ğŸ”´ (ë¹¨ê°•)</option>
			                        <option value="ì£¼í™©">ğŸŸ  (ì£¼í™©)</option>
			                        <option value="ë…¸ë‘">ğŸŸ¡ (ë…¸ë‘)</option>
			                        <option value="ì´ˆë¡">ğŸŸ¢ (ì´ˆë¡)</option>
			                        <option value="íŒŒë‘">ğŸ”µ (íŒŒë‘)</option>
			                        <option value="ë‚¨ìƒ‰">ğŸ”µ+ğŸŸ£(ë‚¨ìƒ‰)</option>
			                        <option value="ë³´ë¼">ğŸŸ£ (ë³´ë¼)</option>
			                    </select>
			                </td>
			            </tr>
			
			            <!-- ë³´ì•ˆ ì§ˆë¬¸: ì¢‹ì•„í•˜ëŠ” ê³„ì ˆ -->
			            <tr>
			                <td class="font-medium p-2">ê³„ì ˆ</td>
			                <td class="p-2">
			                    <select id="mySeason" name="mySeason" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" required>
			                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
			                        <option value="ì¶˜">ğŸŒ¸ ë´„</option>
			                        <option value="í•˜">ğŸ–ï¸ ì—¬ë¦„</option>
			                        <option value="ì¶”">ğŸ ê°€ì„</option>
			                        <option value="ë™">â˜ƒï¸ ê²¨ìš¸</option>
			                    </select>
			                </td>
			            </tr>
			
			            <!-- ë³´ì•ˆ ì§ˆë¬¸: ì¢‹ì•„í•˜ëŠ” ìˆ«ì -->
			            <tr>
			                <td class="font-medium p-2">ìˆ«ì (0~10)</td>
			                <td class="p-2">
			                    <select id="myNumber" name="myNumber" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" required>
			                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
									<option value="0">0 ğŸŒ€</option>
									<option value="1">1 ğŸŒ±</option>
									<option value="2">2 ğŸ£</option>
									<option value="3">3 ğŸˆ</option>
									<option value="4">4 ğŸ€</option>
									<option value="5">5 ğŸŒŸ</option>
									<option value="6">6 ğŸŒŠ</option>
									<option value="7">7 ğŸµ</option>
									<option value="8">8 ğŸ§©</option>
									<option value="9">9 ğŸ”¥</option>
									<option value="10">10 ğŸ¯</option>
			                    </select>
			                </td>
			            </tr>
			        </tbody>
			    </table>

                <div class="mt-6 transition-opacity duration-300" id="hiddenButtons">
		            <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
		            <div class="flex justify-between mt-2 text-sm text-blue-500 cursor-pointer">
		                <a th:href="@{/User/FindUserId.html}" class="hover:underline">ID ì°¾ê¸°</a>
		                <a th:href="@{/User/Login.html}" class="hover:underline">ë¡œê·¸ì¸</a>
		                <a th:href="@{/User/JoinUser.html}" class="hover:underline">íšŒì› ê°€ì…</a>
		            </div>
		        </div>
	        </form>
        </div>
        <div id="resultLayer" class="hidden grid grid-cols-1 gap-4"></div>
    </div>

    <th:block layout:fragment="script">
    
    <script th:inline="javascript">
        document.getElementById("findPwForm").addEventListener("submit", async function(event) {
            event.preventDefault();
            
            const formData = new FormData(this);
            try {
                const response = await fetch(/*[[@{/User/FindUserPw.layer}]]*/ null, {
                    method: "POST",
                    body: formData,
                    headers: {
                        "X-Requested-With": "XMLHttpRequest" // AJAX ìš”ì²­ì„ì„ ì•Œë¦¼
                    }
                });

                const result = await response.text();

                // ì‘ë‹µì„ ì²˜ë¦¬í•˜ì—¬ ê²°ê³¼ Layer í‘œì‹œ
                const resultLayer = document.getElementById("resultLayer");
                resultLayer.innerHTML = result;
                
        		// ìƒˆë¡œ ì¶”ê°€ëœ script íƒœê·¸ ì‹¤í–‰ (Thymeleaf script ì‹¤í–‰)
        		resultLayer.querySelectorAll("script").forEach(oldScript => {
        			const newScript = document.createElement("script");
        			newScript.textContent = oldScript.textContent;
        			document.body.appendChild(newScript);
        			oldScript.remove();
        		});
                
        		resultLayer.classList.remove("hidden");
                document.getElementById("requestLayer").classList.add("hidden");
            } catch (error) {
                console.error("Error:", error);
            }
        });
    </script>
    </th:block>
</div>