<div xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{Auth/UserLayout}">
    
    <th:block layout:fragment="title"><br/><br/>비밀번호 찾기</th:block>

	<th:block layout:fragment="css"></th:block>
	
    <div layout:fragment="content">
    	<div id="requestLayer" class="grid grid-cols-1 gap-4">
	        <form id="findPwForm" >
	        	<table class="w-full border-collapse">
			        <tbody>
			            <!-- ID -->
			            <tr>
			                <td class="w-1/4 font-medium p-2"><label for="id">아이디</label></td>
			                <td class="w-3/4 p-2">
			                    <input type="text" id="id" name="id" class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-400" minlength="4" maxlength="20" required>
			                    <p id="idCheckMessage" class="text-sm mt-1 text-red-500"></p>
			                </td>
			            </tr>
			            
			            <th:block th:replace="~{Auth/AuthHint :: AuthHint}"></th:block>
			        </tbody>
			    </table>

                <div class="mt-6 transition-opacity duration-300" id="hiddenButtons">
		            <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600">비밀번호 찾기</button>
		            <div class="flex justify-between mt-2 text-sm text-blue-500 cursor-pointer">
		                <a th:href="@{/Auth/Login.html}" class="hover:underline">로그인</a>
		                <a th:href="@{/Auth/JoinUser.html}" class="hover:underline">회원 가입</a>
		            </div>
		        </div>
	        </form>
        </div>
        <div id="resultLayer" class="hidden grid grid-cols-1 gap-4"></div>
    </div>

    <th:block layout:fragment="script">
    
    <script th:inline="javascript">
        document.getElementById("findPwForm").addEventListener("submit", async function(event) {
            event.preventDefault();
            
            const formData = new FormData(this);
            formData.append("token", /*[[${unique.token}]]*/ null);
            formData.append("rsaId", /*[[${unique.rsaId}]]*/ null);
            
            try {
                const response = await fetch(/*[[@{/Auth/FindUserPw.layer}]]*/ null, {
                    method: "POST",
                    body: formData,
                    headers: {
                        "X-Requested-With": "XMLHttpRequest" // AJAX 요청임을 알림
                    }
                });

                const result = await response.text();

                // 응답을 처리하여 결과 Layer 표시
                const resultLayer = document.getElementById("resultLayer");
                resultLayer.innerHTML = result;
                
        		// 새로 추가된 script 태그 실행 (Thymeleaf script 실행)
        		resultLayer.querySelectorAll("script").forEach(oldScript => {
        			const newScript = document.createElement("script");
        			newScript.textContent = oldScript.textContent;
        			document.body.appendChild(newScript);
        			oldScript.remove();
        		});
                
        		resultLayer.classList.remove("hidden");
                document.getElementById("requestLayer").classList.add("hidden");
            } catch (error) {
                console.error("Error:", error);
            }
        });
    </script>
    </th:block>
</div>