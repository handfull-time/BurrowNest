<div xmlns:th="http://www.thymeleaf.org" th:fragment="content">
    <div class="text-center space-y-6">
    	<h1 class="text-4xl font-bold text-blue-600">ğŸ‡ BurrowNest</h1>
    	<p class="text-lg text-gray-700 font-medium">í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬</p>
    	
    	<div class="space-y-1">
    		<p class="text-sm text-gray-500">BurrowNestë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì•„ë˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
    		<p class="text-sm text-gray-500">ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì„¤ì¹˜í•˜ì„¸ìš”:</p>
    		<p class="text-sm text-gray-500">1. ffmpeg: <code class="font-mono">sudo apt install -y ffmpeg</code></p>
    		<p class="text-sm text-gray-500">2. exiftool: <code class="font-mono">sudo apt install -y exiftool</code></p>
    	</div>   	
    	
    	<div class="flex justify-between pt-6">
    		<button type="button"
    			class="bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400 transition"
    			onclick="prevPage('PageStorageLib', 'PagePasswd')">
    			ì´ì „
    		</button>
    		
    		<!-- <button type="button"
    			class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition"
    			onclick="nextPage('PageStorageLib', 'PageStorageSelect')">
    			ë‹¤ìŒ
    		</button> -->
    		<button type="button" id="applyBtn" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition" th:onclick="apply()">ì§„í–‰</button>
    	</div>
    </div>
    
    <script th:inline="javascript">
    async function apply(){
    	
    	buttonStatus( "applyBtn", false);
    	
    	const encrypt = new JSEncrypt();
        encrypt.setPublicKey(/*[[${unique.publicKey}]]*/ null);

        const encPw = encrypt.encrypt( document.getElementById("password").value );	
	
        const imageData = await getProfileImage();
    	if (!imageData) {
    		showCustomAlert("ì´ë¯¸ì§€ ì²˜ë¦¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    		return;
    	}
        
        const formData = new FormData();
        formData.append("token", /*[[${unique.token}]]*/ null);
        formData.append("rsaId", /*[[${unique.rsaId}]]*/ null);
        formData.append("id", document.getElementById("id").value);
        formData.append("pw", encPw );
        formData.append("profileImg", imageData);
        formData.append("nickname", document.getElementById("nickname").value);
        formData.append("myRainbow", document.getElementById("myRainbow").value);
        formData.append("mySeason", document.getElementById("mySeason").value);
        formData.append("myNumber", document.getElementById("myNumber").value);
        
		try {
	        const res = await fetch(/*[[@{/Intro/SaveInit.json}]]*/ null, {
                method: "POST",
                body: formData,
                credentials: "include"
            });
	        
	        console.info('âœ… response', res);

	        if (res.ok) {
	        	console.info('ì‘ì—… ì§„í–‰ ì¤‘');
	        	nextPage('PageStorageLib', 'PageComplete');
	        }
	        return true;
	    } catch (err) {
	        console.error("refreshToken ì‹¤íŒ¨:", err);
	        buttonStatus( "applyBtn", true);
	        return false;
	    }
    }
    
    </script>
</div>
