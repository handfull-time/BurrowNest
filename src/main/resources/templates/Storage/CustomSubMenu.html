<div 
	xmlns:th="http://www.thymeleaf.org" 
	th:fragment="customMenu"> 

   <!-- ì»¤ìŠ¤í…€ ìš°í´ë¦­ ë©”ë‰´ -->
  <ul id="contextMenu" class="absolute hidden bg-white border border-gray-300 shadow-lg rounded-md w-56 text-sm z-50">
    <li class="flex items-center px-4 py-2 hover:bg-gray-100 cursor-pointer" data-action="open">
      <span class="mr-2">ğŸ“‚</span> ì—´ê¸°
    </li>
    <hr class="my-1 border-gray-200">

    <li class="flex items-center px-4 py-2 hover:bg-gray-100 cursor-pointer" data-action="cut">
      <span class="mr-2">âœ‚ï¸</span> ì˜ë¼ë‚´ê¸°
    </li>
    <li class="flex items-center px-4 py-2 hover:bg-gray-100 cursor-pointer" data-action="copy">
      <span class="mr-2">ğŸ“„</span> ë³µì‚¬
    </li>
    <li class="flex items-center px-4 py-2 hover:bg-gray-100 text-gray-400 cursor-not-allowed" data-action="paste">
      <span class="mr-2">ğŸ“‹</span> ë¶™ì—¬ë„£ê¸°
    </li>

    <li class="flex items-center px-4 py-2 hover:bg-gray-100 cursor-pointer" data-action="rename">
      <span class="mr-2">ğŸ“„</span> ì´ë¦„ë³€ê²½
    </li>

    <hr class="my-1 border-gray-200">

    <li class="flex items-center px-4 py-2 hover:bg-gray-100 cursor-pointer" data-action="detail">
      <span class="mr-2">âš™ï¸</span> ì†ì„±
    </li>
  </ul>

  <script>
  
  console.info( 'contextMenu' );
  const contextMenu = document.getElementById("contextMenu");


//ìš°í´ë¦­ ë©”ë‰´ í‘œì‹œ
  document.addEventListener("contextmenu", function (e) {
    const targetRow = e.target.closest("[data-node]");
    if (!targetRow) return contextMenu.classList.add("hidden");

    e.preventDefault();
    const rect = targetRow.getBoundingClientRect();

    storage.selectDirectory(targetRow._nodeData);
    contextMenu.style.top = `${e.clientY}px`;
    contextMenu.style.left = `${e.clientX}px`;
    contextMenu.classList.remove("hidden");
  });
  
//ìš°í´ë¦­ ë©”ë‰´ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì˜ˆì‹œ
  document.getElementById("contextMenu").addEventListener("click", async (e) => {
    const action = e.target.closest("[data-action]")?.dataset?.action;
    if (!action) return;

    const current = storage.getSelectedDirectory();
    if (!current) return;

    switch (action) {
      case "copy": storage.copyDirectory(); break;
      case "cut": storage.cutDirectory(); break;
      case "paste":
        if (storage.isClipboardAvailable()) {
          await storage.pasteDirectory(current.owner.uid);
          alert("ë¶™ì—¬ë„£ê¸° ì™„ë£Œ!");
          storage.clearClipboard();
        }
        break;
      case "rename":
        const newName = prompt("ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", current.owner.name);
        if (newName) alert(`ì´ë¦„ì„ '${newName}' ìœ¼ë¡œ ë°”ê¿”ì•¼ í•©ë‹ˆë‹¤ (API í•„ìš”)`);
        break;
      case "detail":
        alert(JSON.stringify(current.owner, null, 2));
        break;
      case "open":
        alert("ì—´ê¸° ê¸°ëŠ¥ì€ ì‚¬ìš©ì ì •ì˜ì— ë”°ë¼ êµ¬í˜„");
        break;
    }
    updatePasteButton();
  });
  
	function contextMenuHide(){
		if (!contextMenu.classList.contains("hidden")) {
			contextMenu.classList.add("hidden");
		}
  	}
  
  	document.addEventListener("click", (e) => {
	  	e.preventDefault();
		const isInsideMenu = e.target.closest("#contextMenu");
		if (!isInsideMenu) {
				contextMenuHide();
		}
    });
  
 	</script>
</div>
